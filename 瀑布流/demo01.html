<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #main {
            position: relative;
            margin: auto;
            background: #f0f0f0;
        }

        .item {
            transition: .5s all;
            position: absolute;
            padding: 10px;
        }

        .pic {
            padding: 10px;
            border: 1px solid #666;
            width: 220px
        }

        img {
            width: 220px;
        }

        .head {
            width: 100px;
            height: 100px;
            border: 1px solid #666;
            float: left;
            margin: 0 5px 5px 0;
        }
        .patMsg{
            display: inline-block;
            width: 100%;
        }
        .msg{
           color: #777;
        }
    </style>
</head>
<body>
<section id="main">
    <div class="item">
        <div class="pic">
            <div class="head">
            </div>
            <span class="patMsg">姓名: <span class="msg">张翼德</span></span>
            <span class="patMsg">性别: <span class="msg">男</span></span>
            <span class="patMsg">年龄: <span class="msg">45</span></span>
            <span class="patMsg">住院号: <span class="msg">123321</span></span>
            <span class="patMsg">病种: <span class="msg">脑癌</span></span>
            <span class="patMsg">当前治疗类型: <span class="msg">化疗2期化疗2期化疗2期化疗2期化疗2期</span></span>
            <span class="patMsg">疼痛评分信息: <span class="msg">3分</span></span>
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium aliquam aperiam asperiores at
            doloremque ducimus enim expedita facilis id ipsam laudantium perspiciatis placeat, quibusdam rerum sit
            soluta tenetur vel veritatis.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dignissimos inventore iste laboriosam modi nisi.
            Autem dignissimos inventore laboriosam, quisquam quod ratione rem sint? Aliquam eaque laboriosam nostrum
            nulla ullam voluptatum!
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci aliquam at distinctio eum facilis iste,
            itaque necessitatibus nihil nulla voluptas. Ab dolores illum laboriosam natus porro! Consequuntur
            dignissimos reprehenderit vero.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut beatae doloremque ea iusto sequi. Dicta error
            ipsum itaque nemo neque nobis quia quis sint tempore? Dignissimos magni nemo quasi quod?Lorem ipsum dolor
            sit amet, consectetur adipisicing elit. Ab accusamus accusantium amet blanditiis doloremque eos harum hic
            in, incidunt, ipsa iste magni minima mollitia numquam officiis pariatur, quibusdam recusandae tempore?
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus autem, consectetur cumque dignissimos
            eaque excepturi ipsa ipsam, labore maxime odio perferendis placeat provident quasi similique temporibus vero
            vitae voluptates voluptatum.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Error excepturi in mollitia nisi quos rem unde
            voluptate! Alias atque autem, error excepturi facere illum in incidunt magni numquam quam tenetur?
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur cumque dolor ducimus, eos est fugit
            ipsum quas quisquam rerum sed! Ab doloribus esse fugiat minima, modi neque quis repudiandae voluptates?
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus adipisci animi aspernatur autem, dicta
            ex fugit illo illum ipsa maxime, minus nemo neque placeat quae quaerat sit voluptate. Maiores, recusandae.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci commodi consectetur consequatur
            consequuntur ducimus eveniet facere facilis illum laudantium, minima molestias obcaecati quam quis repellat
            rerum saepe sequi velit voluptates?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam beatae
            consectetur eius est ex excepturi harum laboriosam laudantium, magni molestiae molestias, obcaecati
            quibusdam recusandae soluta suscipit temporibus vel vero voluptates.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Assumenda consequatur consequuntur eius eveniet
            inventore ipsa laboriosam modi nobis omnis possimus praesentium velit voluptatem, voluptates. Ad at
            distinctio earum error ipsa!
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab accusamus autem distinctio enim esse est, et
            illo minus molestiae non obcaecati odit pariatur provident, quasi ratione tempora vel veniam voluptatibus!
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aspernatur aut dolores inventore libero nemo
            nostrum quasi, vitae. Ad commodi cum eaque minus quae, saepe! Dolore dolores fugit maxime numquam sapiente?
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab accusamus architecto consequuntur earum
            expedita fugit ipsam itaque labore laboriosam libero, natus nisi officia perspiciatis praesentium quisquam
            quo tempora? Sapiente, sit.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, aliquam corporis debitis eligendi iste
            minima non numquam quaerat quibusdam reiciendis tempore, voluptas voluptate, voluptatem. Dolores error
            explicabo facere natus officia.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Animi enim harum qui quidem, quisquam totam!
            Accusamus accusantium adipisci assumenda dicta ducimus eos error illo modi odit quos, reprehenderit sed
            velit.
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquid architecto dicta praesentium recusandae
            sequi soluta sunt tenetur. Architecto atque blanditiis impedit laboriosam laborum nihil odit quia quod, sit
            tempora velit?
        </div>
    </div>
    <div class="item">
        <div class="pic">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Beatae ex omnis tempore. Adipisci commodi delectus
            deserunt est, fugit hic in odit quasi quisquam veritatis? Aspernatur eveniet magnam maxime quo quod?
        </div>
    </div>
</section>
<script>
    waterFall('main', 'item');//调用函数
    window.onresize = function () {
        waterFall('main', 'item');
    };//网页大小改变时同样调用函数
    var dataInt = {"data": [{"src": "images/1.png"}, {"src": "images/2.png"}, {"src": "images/3.png"}, {"src": "images/4.png"}]};//暂时使用本地数据
    window.onscroll = function () {//滚动事件
        if (fnScroll()) {//当满足条件时触发
            var oParent = document.getElementById('main');
            for (var i = 0; i < dataInt.data.length; i++) {
                var aChild = document.createElement('div');
                aChild.className = 'item';
                oParent.appendChild(aChild);
                var oBox = document.createElement('div');
                oBox.className = 'pic';
                aChild.appendChild(oBox);
                var oImg = document.createElement('img');
                oImg.src = dataInt.data[i].src;
                oBox.appendChild(oImg)
            }
            waterFall('main', 'item');//调用函数
        }
    };

    function waterFall(parent, child) {
        var oParent = document.getElementById(parent),//父级
            aChild = oParent.getElementsByClassName(child) || oParent.children, //子集（IE9以下不支持getElementsByClassName）
            oneWidth = aChild[0].offsetWidth, //原生offsetWidth,包括padding。
            cols = Math.floor((document.documentElement.clientWidth || document.body.clientWidth) / oneWidth),  // 网页宽度/一个元素宽度=列数，Math.floor()表示向下取整。
            aHeight = []; //声明一个空数组来存储每一列的高度
        for (var i = 0; i < aChild.length; i++) {
            if (i < cols) { //i < cols表示是第一行的元素
                aChild[i].style.top = 0; // 第一行top为0
                aChild[i].style.left = i * oneWidth + 'px'; // 第一行left=下标*一个元素的宽度
                aHeight[i] = aChild[i].offsetHeight; // 把第一行每个的高度存进aHeight数组中
            } else {
                var minHeight = Math.min.apply(null, aHeight), // 使用Math.min.apply()得到数组中的最小数，即第一行高度最矮的
                    minIdx = aHeight.indexOf(minHeight); // 获取对应的下标（IE8以上）
                aChild[i].style.top = minHeight + 'px'; // 定位，top为上一行最小的高度值
                aChild[i].style.left = minIdx * oneWidth + 'px'; // left为对应下标*一个元素宽度
                aHeight[minIdx] += aChild[i].offsetHeight; //更新数组，总是最小高度的一列加上后面的元素的高度。
            }//样式布局完成
        }
        var maxHeight = Math.max.apply(null, aHeight);
        oParent.style.height = maxHeight + 'px'; //因为是绝对定位absolute，所以父级没有高度，需要取最高的一列的高度给父级
        oParent.style.width = cols * oneWidth + 'px'; //设置父级宽度
    }

    function fnScroll() {
        var oParent = document.getElementById('main'),//父级
            aChild = oParent.getElementsByClassName('item');
        var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop, //兼容写法，获取scrollTop
            viewHeight = document.documentElement.clientHeight, //视窗高度（即看到的一屏的高度）
            lastTop = aChild[aChild.length - 1].offsetTop + Math.floor(aChild[aChild.length - 1].offsetHeight / 2);//最后一个子元素距离网页顶部+自身高度的一半，实现未滚动到底就开始加载
        return (lastTop < scrollTop + viewHeight) ? true : false;//到达指定高度后 返回true，触发waterfall()函数 //如果满足条件返回true，否则返回false
    }


</script>
</body>
</html>